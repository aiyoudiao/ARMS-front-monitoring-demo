{"version":3,"file":"captcha-Ibx4Alu7.js","sources":["../../node_modules/.pnpm/ahooks@3.8.1_react@18.3.1/node_modules/ahooks/es/useCountDown/index.js","../../packages/hooks/src/use-count-down.ts","../../src/hooks/business/captcha.ts"],"sourcesContent":["import { __read } from \"tslib\";\nimport dayjs from 'dayjs';\nimport { useEffect, useMemo, useState } from 'react';\nimport useLatest from '../useLatest';\nimport { isNumber } from '../utils/index';\nvar calcLeft = function (target) {\n  if (!target) {\n    return 0;\n  }\n  // https://stackoverflow.com/questions/4310953/invalid-date-in-safari\n  var left = dayjs(target).valueOf() - Date.now();\n  return left < 0 ? 0 : left;\n};\nvar parseMs = function (milliseconds) {\n  return {\n    days: Math.floor(milliseconds / 86400000),\n    hours: Math.floor(milliseconds / 3600000) % 24,\n    minutes: Math.floor(milliseconds / 60000) % 60,\n    seconds: Math.floor(milliseconds / 1000) % 60,\n    milliseconds: Math.floor(milliseconds) % 1000\n  };\n};\nvar useCountdown = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  var _a = options || {},\n    leftTime = _a.leftTime,\n    targetDate = _a.targetDate,\n    _b = _a.interval,\n    interval = _b === void 0 ? 1000 : _b,\n    onEnd = _a.onEnd;\n  var memoLeftTime = useMemo(function () {\n    return isNumber(leftTime) && leftTime > 0 ? Date.now() + leftTime : undefined;\n  }, [leftTime]);\n  var target = 'leftTime' in options ? memoLeftTime : targetDate;\n  var _c = __read(useState(function () {\n      return calcLeft(target);\n    }), 2),\n    timeLeft = _c[0],\n    setTimeLeft = _c[1];\n  var onEndRef = useLatest(onEnd);\n  useEffect(function () {\n    if (!target) {\n      // for stop\n      setTimeLeft(0);\n      return;\n    }\n    // 立即执行一次\n    setTimeLeft(calcLeft(target));\n    var timer = setInterval(function () {\n      var _a;\n      var targetLeft = calcLeft(target);\n      setTimeLeft(targetLeft);\n      if (targetLeft === 0) {\n        clearInterval(timer);\n        (_a = onEndRef.current) === null || _a === void 0 ? void 0 : _a.call(onEndRef);\n      }\n    }, interval);\n    return function () {\n      return clearInterval(timer);\n    };\n  }, [target, interval]);\n  var formattedRes = useMemo(function () {\n    return parseMs(timeLeft);\n  }, [timeLeft]);\n  return [timeLeft, formattedRes];\n};\nexport default useCountdown;","import { useState } from 'react';\nimport { useCountDown } from 'ahooks';\n\n/**\n * count down\n *\n * @param seconds - count down seconds\n */\nexport default function useCountDownTimer(seconds: number) {\n  const [fps, setFps] = useState(0);\n\n  const [countdown] = useCountDown({ targetDate: fps });\n\n  const count = Math.round(countdown / 1000);\n  const isCounting = countdown > 0;\n  function start(updateSeconds: number = seconds) {\n    setFps(Date.now() + updateSeconds * 1000);\n  }\n\n  function stop() {\n    setFps(0);\n  }\n\n  return {\n    count,\n    isCounting,\n    start,\n    stop\n  };\n}\n","import { useCountDownTimer, useLoading } from '@sa/hooks';\nimport { REG_PHONE } from '@/constants/reg';\nexport function useCaptcha() {\n  const { loading, startLoading, endLoading } = useLoading();\n  const { count, start, isCounting } = useCountDownTimer(10);\n  const { t } = useTranslation();\n  const label = useMemo(() => {\n    let text = t('page.login.codeLogin.getCode');\n\n    const countingLabel = t('page.login.codeLogin.reGetCode', { time: count });\n\n    if (loading) {\n      text = '';\n    }\n\n    if (isCounting) {\n      text = countingLabel;\n    }\n\n    return text;\n  }, [count]);\n\n  function isPhoneValid(phone: string) {\n    if (phone.trim() === '') {\n      return false;\n    }\n\n    if (!REG_PHONE.test(phone)) {\n      return false;\n    }\n\n    return true;\n  }\n  async function getCaptcha(phone: string) {\n    const valid = isPhoneValid(phone);\n\n    if (!valid || loading) {\n      return;\n    }\n\n    startLoading();\n\n    // request\n    await new Promise(resolve => {\n      setTimeout(resolve, 500);\n    });\n\n    start();\n\n    endLoading();\n  }\n\n  return {\n    label,\n    isCounting,\n    loading,\n    getCaptcha\n  };\n}\n"],"names":["calcLeft","target","left","dayjs","parseMs","milliseconds","useCountdown","options","_a","leftTime","targetDate","_b","interval","onEnd","memoLeftTime","useMemo","isNumber","_c","__read","useState","timeLeft","setTimeLeft","onEndRef","useLatest","useEffect","timer","targetLeft","formattedRes","useCountDownTimer","seconds","fps","setFps","countdown","useCountDown","count","isCounting","start","updateSeconds","stop","useCaptcha","loading","startLoading","endLoading","useLoading","t","useTranslation","label","text","countingLabel","isPhoneValid","phone","REG_PHONE","getCaptcha","resolve"],"mappings":"8QAKA,IAAIA,EAAW,SAAUC,EAAQ,CAC/B,GAAI,CAACA,EACH,MAAO,GAGT,IAAIC,EAAOC,EAAMF,CAAM,EAAE,UAAY,KAAK,MAC1C,OAAOC,EAAO,EAAI,EAAIA,CACxB,EACIE,EAAU,SAAUC,EAAc,CACpC,MAAO,CACL,KAAM,KAAK,MAAMA,EAAe,KAAQ,EACxC,MAAO,KAAK,MAAMA,EAAe,IAAO,EAAI,GAC5C,QAAS,KAAK,MAAMA,EAAe,GAAK,EAAI,GAC5C,QAAS,KAAK,MAAMA,EAAe,GAAI,EAAI,GAC3C,aAAc,KAAK,MAAMA,CAAY,EAAI,GAC7C,CACA,EACIC,EAAe,SAAUC,EAAS,CAChCA,IAAY,SACdA,EAAU,CAAA,GAEZ,IAAIC,EAAKD,GAAW,CAAE,EACpBE,EAAWD,EAAG,SACdE,EAAaF,EAAG,WAChBG,EAAKH,EAAG,SACRI,EAAWD,IAAO,OAAS,IAAOA,EAClCE,EAAQL,EAAG,MACTM,EAAeC,EAAAA,QAAQ,UAAY,CACrC,OAAOC,EAASP,CAAQ,GAAKA,EAAW,EAAI,KAAK,IAAG,EAAKA,EAAW,MACxE,EAAK,CAACA,CAAQ,CAAC,EACTR,EAAS,aAAcM,EAAUO,EAAeJ,EAChDO,EAAKC,EAAOC,EAAAA,SAAS,UAAY,CACjC,OAAOnB,EAASC,CAAM,CACvB,CAAA,EAAG,CAAC,EACLmB,EAAWH,EAAG,CAAC,EACfI,EAAcJ,EAAG,CAAC,EAChBK,EAAWC,EAAUV,CAAK,EAC9BW,EAAAA,UAAU,UAAY,CACpB,GAAI,CAACvB,EAAQ,CAEXoB,EAAY,CAAC,EACb,MACD,CAEDA,EAAYrB,EAASC,CAAM,CAAC,EAC5B,IAAIwB,EAAQ,YAAY,UAAY,CAClC,IAAIjB,EACAkB,EAAa1B,EAASC,CAAM,EAChCoB,EAAYK,CAAU,EAClBA,IAAe,IACjB,cAAcD,CAAK,GAClBjB,EAAKc,EAAS,WAAa,MAAQd,IAAO,QAAkBA,EAAG,KAAKc,CAAQ,EAEhF,EAAEV,CAAQ,EACX,OAAO,UAAY,CACjB,OAAO,cAAca,CAAK,CAChC,CACA,EAAK,CAACxB,EAAQW,CAAQ,CAAC,EACrB,IAAIe,EAAeZ,EAAAA,QAAQ,UAAY,CACrC,OAAOX,EAAQgB,CAAQ,CAC3B,EAAK,CAACA,CAAQ,CAAC,EACb,MAAO,CAACA,EAAUO,CAAY,CAChC,EC3DA,SAAwBC,EAAkBC,EAAiB,CACzD,KAAM,CAACC,EAAKC,CAAM,EAAIZ,WAAS,CAAC,EAE1B,CAACa,CAAS,EAAIC,EAAa,CAAE,WAAYH,EAAK,EAE9CI,EAAQ,KAAK,MAAMF,EAAY,GAAI,EACnCG,EAAaH,EAAY,EACtB,SAAAI,EAAMC,EAAwBR,EAAS,CAC9CE,EAAO,KAAK,IAAQ,EAAAM,EAAgB,GAAI,CAC1C,CAEA,SAASC,GAAO,CACdP,EAAO,CAAC,CACV,CAEO,MAAA,CACL,MAAAG,EACA,WAAAC,EACA,MAAAC,EACA,KAAAE,CAAA,CAEJ,CC3BO,SAASC,GAAa,CAC3B,KAAM,CAAE,QAAAC,EAAS,aAAAC,EAAc,WAAAC,GAAeC,EAAW,EACnD,CAAE,MAAAT,EAAO,MAAAE,EAAO,WAAAD,CAAW,EAAIP,EAAkB,EAAE,EACnD,CAAE,EAAAgB,GAAMC,IACRC,EAAQ/B,EAAAA,QAAQ,IAAM,CACtB,IAAAgC,EAAOH,EAAE,8BAA8B,EAE3C,MAAMI,EAAgBJ,EAAE,iCAAkC,CAAE,KAAMV,EAAO,EAEzE,OAAIM,IACKO,EAAA,IAGLZ,IACKY,EAAAC,GAGFD,CAAA,EACN,CAACb,CAAK,CAAC,EAEV,SAASe,EAAaC,EAAe,CAKnC,MAJI,EAAAA,EAAM,KAAK,IAAM,IAIjB,CAACC,EAAU,KAAKD,CAAK,EAK3B,CACA,eAAeE,EAAWF,EAAe,CAGnC,CAFUD,EAAaC,CAAK,GAElBV,IAIDC,IAGP,MAAA,IAAI,QAAmBY,GAAA,CAC3B,WAAWA,EAAS,GAAG,CAAA,CACxB,EAEKjB,IAEKM,IACb,CAEO,MAAA,CACL,MAAAI,EACA,WAAAX,EACA,QAAAK,EACA,WAAAY,CAAA,CAEJ","x_google_ignoreList":[0]}