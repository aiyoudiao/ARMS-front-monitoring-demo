{"version":3,"file":"index-V1ny79ev.js","sources":["../../src/hooks/business/auth.ts","../../src/pages/function/toggle-auth/index.tsx"],"sourcesContent":["import { getIsLogin, selectUserInfo } from '@/store/slice/auth';\n\nexport function useAuth() {\n  const userInfo = useAppSelector(selectUserInfo);\n  const isLogin = useAppSelector(getIsLogin);\n  function hasAuth(codes: string | string[]) {\n    if (!isLogin) {\n      return false;\n    }\n\n    if (typeof codes === 'string') {\n      return userInfo.buttons.includes(codes);\n    }\n\n    return codes.some(code => userInfo.buttons.includes(code));\n  }\n\n  return {\n    hasAuth\n  };\n}\n","import { Button, Card, Descriptions, Space, Tag } from 'antd';\nimport type { DescriptionsProps } from 'antd';\nimport { useLoading } from '@sa/hooks';\nimport { selectUserInfo } from '@/store/slice/auth';\nimport { reloadPage } from '@/store/slice/app';\n\nimport { initTabStore } from '@/store/slice/tab';\nimport { router } from '@/router';\nimport { useLogin } from '@/hooks/common/login';\n\ntype AccountKey = 'super' | 'admin' | 'user';\n\ninterface Account {\n  key: AccountKey;\n  label: string;\n  userName: string;\n  password: string;\n}\n\nexport function Component() {\n  const { t } = useTranslation();\n\n  const userInfo = useAppSelector(selectUserInfo);\n\n  const { hasAuth } = useAuth();\n  const { toLogin } = useLogin();\n  const { loading, startLoading, endLoading } = useLoading();\n\n  const dispatch = useAppDispatch();\n\n  const [loginAccount, setLoginAccount] = useState<AccountKey>('super');\n\n  const accounts: Account[] = [\n    {\n      key: 'super',\n      label: t('page.login.pwdLogin.superAdmin'),\n      userName: 'Super',\n      password: '123456'\n    },\n    {\n      key: 'admin',\n      label: t('page.login.pwdLogin.admin'),\n      userName: 'Admin',\n      password: '123456'\n    },\n    {\n      key: 'user',\n      label: t('page.login.pwdLogin.user'),\n      userName: 'User',\n      password: '123456'\n    }\n  ];\n\n  const roles: DescriptionsProps['items'] = [\n    {\n      key: '1',\n      label: t('page.manage.user.userRole'),\n      children: (\n        <Space>\n          {userInfo.roles.map(role => (\n            <Tag key={role}>{role}</Tag>\n          ))}\n        </Space>\n      )\n    },\n    {\n      key: '2',\n      label: t('page.function.toggleAuth.toggleAccount'),\n      children: (\n        <Space>\n          {accounts.map(account => (\n            <Button\n              disabled={loading && loginAccount !== account.key}\n              loading={loading && loginAccount === account.key}\n              key={account.key}\n              onClick={() => handleToggleAccount(account)}\n            >\n              {account.label}\n            </Button>\n          ))}\n        </Space>\n      )\n    }\n  ];\n\n  async function handleToggleAccount(account: Account) {\n    setLoginAccount(account.key);\n\n    startLoading();\n\n    router.resetRoute();\n\n    await toLogin({ userName: account.userName, password: account.password }, false);\n\n    dispatch(initTabStore());\n\n    endLoading();\n\n    dispatch(reloadPage());\n  }\n  return (\n    <Space\n      direction=\"vertical\"\n      size={16}\n      className=\"w-full\"\n    >\n      <Card\n        title={t('request.logout')}\n        bordered={false}\n        className=\"card-wrapper\"\n        size=\"small\"\n      >\n        <Descriptions\n          bordered\n          layout=\"vertical\"\n          size=\"small\"\n          column={1}\n          items={roles}\n        />\n        <Card\n          title={t('page.function.toggleAuth.authHook')}\n          bordered={false}\n          className=\"card-wrapper\"\n          size=\"small\"\n        >\n          <Space>\n            {hasAuth('B_CODE1') && <Button>{t('page.function.toggleAuth.superAdminVisible')}</Button>}\n            {hasAuth('B_CODE2') && <Button>{t('page.function.toggleAuth.adminVisible')}</Button>}\n            {hasAuth('B_CODE3') && <Button>{t('page.function.toggleAuth.adminOrUserVisible')}</Button>}\n          </Space>\n        </Card>\n      </Card>\n    </Space>\n  );\n}\n"],"names":["useAuth","userInfo","useAppSelector","selectUserInfo","isLogin","getIsLogin","hasAuth","codes","code","Component","t","useTranslation","toLogin","useLogin","loading","startLoading","endLoading","useLoading","dispatch","useAppDispatch","loginAccount","setLoginAccount","useState","accounts","roles","jsx","Space","role","Tag","account","Button","handleToggleAccount","router","initTabStore","reloadPage","jsxs","Card","Descriptions"],"mappings":"okBAEO,SAASA,GAAU,CAClB,MAAAC,EAAWC,EAAeC,CAAc,EACxCC,EAAUF,EAAeG,CAAU,EACzC,SAASC,EAAQC,EAA0B,CACzC,OAAKH,EAID,OAAOG,GAAU,SACZN,EAAS,QAAQ,SAASM,CAAK,EAGjCA,EAAM,KAAKC,GAAQP,EAAS,QAAQ,SAASO,CAAI,CAAC,EAPhD,EAQX,CAEO,MAAA,CACL,QAAAF,CAAA,CAEJ,CCDO,SAASG,GAAY,CACpB,KAAA,CAAE,EAAAC,GAAMC,IAERV,EAAWC,EAAeC,CAAc,EAExC,CAAE,QAAAG,GAAYN,IACd,CAAE,QAAAY,GAAYC,IACd,CAAE,QAAAC,EAAS,aAAAC,EAAc,WAAAC,GAAeC,EAAW,EAEnDC,EAAWC,IAEX,CAACC,EAAcC,CAAe,EAAIC,WAAqB,OAAO,EAE9DC,EAAsB,CAC1B,CACE,IAAK,QACL,MAAOb,EAAE,gCAAgC,EACzC,SAAU,QACV,SAAU,QACZ,EACA,CACE,IAAK,QACL,MAAOA,EAAE,2BAA2B,EACpC,SAAU,QACV,SAAU,QACZ,EACA,CACE,IAAK,OACL,MAAOA,EAAE,0BAA0B,EACnC,SAAU,OACV,SAAU,QACZ,CAAA,EAGIc,EAAoC,CACxC,CACE,IAAK,IACL,MAAOd,EAAE,2BAA2B,EACpC,SACEe,EAAA,IAACC,EACE,CAAA,SAAAzB,EAAS,MAAM,IACd0B,GAAAF,EAAA,IAACG,EAAgB,CAAA,SAAAD,CAAA,EAAPA,CAAY,CACvB,EACH,CAEJ,EACA,CACE,IAAK,IACL,MAAOjB,EAAE,wCAAwC,EACjD,SACEe,EAAAA,IAACC,EACE,CAAA,SAAAH,EAAS,IACRM,GAAAJ,EAAA,IAACK,EAAA,CACC,SAAUhB,GAAWM,IAAiBS,EAAQ,IAC9C,QAASf,GAAWM,IAAiBS,EAAQ,IAE7C,QAAS,IAAME,EAAoBF,CAAO,EAEzC,SAAQA,EAAA,KAAA,EAHJA,EAAQ,GAKhB,CAAA,EACH,CAEJ,CAAA,EAGF,eAAeE,EAAoBF,EAAkB,CACnDR,EAAgBQ,EAAQ,GAAG,EAEdd,IAEbiB,EAAO,WAAW,EAEZ,MAAApB,EAAQ,CAAE,SAAUiB,EAAQ,SAAU,SAAUA,EAAQ,UAAY,EAAK,EAE/EX,EAASe,GAAc,EAEZjB,IAEXE,EAASgB,GAAY,CACvB,CAEE,OAAAT,EAAA,IAACC,EAAA,CACC,UAAU,WACV,KAAM,GACN,UAAU,SAEV,SAAAS,EAAA,KAACC,EAAA,CACC,MAAO1B,EAAE,gBAAgB,EACzB,SAAU,GACV,UAAU,eACV,KAAK,QAEL,SAAA,CAAAe,EAAA,IAACY,EAAA,CACC,SAAQ,GACR,OAAO,WACP,KAAK,QACL,OAAQ,EACR,MAAOb,CAAA,CACT,EACAC,EAAA,IAACW,EAAA,CACC,MAAO1B,EAAE,mCAAmC,EAC5C,SAAU,GACV,UAAU,eACV,KAAK,QAEL,gBAACgB,EACE,CAAA,SAAA,CAAApB,EAAQ,SAAS,GAAKmB,MAACK,EAAQ,CAAA,SAAApB,EAAE,4CAA4C,EAAE,EAC/EJ,EAAQ,SAAS,SAAMwB,EAAQ,CAAA,SAAApB,EAAE,uCAAuC,EAAE,EAC1EJ,EAAQ,SAAS,SAAMwB,EAAQ,CAAA,SAAApB,EAAE,6CAA6C,EAAE,CAAA,EACnF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAGN"}