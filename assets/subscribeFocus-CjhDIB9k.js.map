{"version":3,"file":"subscribeFocus-CjhDIB9k.js","sources":["../../packages/hooks/src/use-request/plugins/useAutoRunPlugin.ts","../../packages/hooks/src/use-request/utils/index.ts","../../packages/hooks/src/use-request/utils/isDocumentVisible.ts","../../packages/hooks/src/use-request/utils/subscribeReVisible.ts","../../packages/hooks/src/use-request/utils/isOnline.ts","../../packages/hooks/src/use-request/utils/subscribeFocus.ts"],"sourcesContent":["import { useRef } from 'react';\nimport { useUpdateEffect } from 'ahooks';\nimport type { Plugin } from '../type';\n\n// support refreshDeps & ready\nconst useAutoRunPlugin: Plugin<any, any[]> = (\n  fetchInstance,\n  { manual, ready = true, defaultParams = [], refreshDeps = [], refreshDepsAction }\n) => {\n  const hasAutoRun = useRef(false);\n  hasAutoRun.current = false;\n\n  useUpdateEffect(() => {\n    if (!manual && ready) {\n      hasAutoRun.current = true;\n      fetchInstance.run(...defaultParams);\n    }\n  }, [ready]);\n\n  useUpdateEffect(() => {\n    if (hasAutoRun.current) {\n      return;\n    }\n    if (!manual) {\n      hasAutoRun.current = true;\n      if (refreshDepsAction) {\n        refreshDepsAction();\n      } else {\n        fetchInstance.refresh();\n      }\n    }\n  }, [...refreshDeps]);\n\n  return {\n    onBefore: () => {\n      if (!ready) {\n        return {\n          stopNow: true\n        };\n      }\n      return null;\n    }\n  };\n};\n\nuseAutoRunPlugin.onInit = ({ ready = true, manual }) => {\n  return {\n    loading: !manual && ready\n  };\n};\n\nexport default useAutoRunPlugin;\n","export const isFunction = (value: unknown): value is (...args: any) => any => typeof value === 'function';\n\nexport const isBrowser = Boolean(typeof window !== 'undefined' && window.document && window.document.createElement);\n\nexport const isDev = import.meta.env.DEV;\n","import { isBrowser } from '.';\n\nexport default function isDocumentVisible(): boolean {\n  if (isBrowser) {\n    return document.visibilityState !== 'hidden';\n  }\n  return true;\n}\n","import isDocumentVisible from './isDocumentVisible';\nimport { isBrowser } from '.';\n\ntype Listener = () => void;\n\nconst listeners: Listener[] = [];\n\nfunction subscribe(listener: Listener) {\n  listeners.push(listener);\n  return function unsubscribe() {\n    const index = listeners.indexOf(listener);\n    listeners.splice(index, 1);\n  };\n}\n\nif (isBrowser) {\n  const revalidate = () => {\n    if (!isDocumentVisible()) return;\n    for (let i = 0; i < listeners.length; i += 1) {\n      const listener = listeners[i];\n      listener();\n    }\n  };\n  window.addEventListener('visibilitychange', revalidate, false);\n}\n\nexport default subscribe;\n","import { isBrowser } from '.';\n\nexport default function isOnline(): boolean {\n  if (isBrowser && typeof navigator.onLine !== 'undefined') {\n    return navigator.onLine;\n  }\n  return true;\n}\n","// from swr\nimport isDocumentVisible from './isDocumentVisible';\nimport isOnline from './isOnline';\nimport { isBrowser } from '.';\n\ntype Listener = () => void;\n\nconst listeners: Listener[] = [];\n\nfunction subscribe(listener: Listener) {\n  listeners.push(listener);\n  return function unsubscribe() {\n    const index = listeners.indexOf(listener);\n    if (index > -1) {\n      listeners.splice(index, 1);\n    }\n  };\n}\n\nif (isBrowser) {\n  const revalidate = () => {\n    if (!isDocumentVisible() || !isOnline()) return;\n    for (let i = 0; i < listeners.length; i += 1) {\n      const listener = listeners[i];\n      listener();\n    }\n  };\n  window.addEventListener('visibilitychange', revalidate, false);\n  window.addEventListener('focus', revalidate, false);\n}\n\nexport default subscribe;\n"],"names":["useAutoRunPlugin","fetchInstance","manual","ready","defaultParams","refreshDeps","refreshDepsAction","hasAutoRun","useRef","useUpdateEffect","isFunction","value","isBrowser","isDocumentVisible","listeners","subscribe","listener","index","revalidate","i","isOnline"],"mappings":"+CAKA,MAAMA,EAAuC,CAC3CC,EACA,CAAE,OAAAC,EAAQ,MAAAC,EAAQ,GAAM,cAAAC,EAAgB,GAAI,YAAAC,EAAc,CAAC,EAAG,kBAAAC,KAC3D,CACG,MAAAC,EAAaC,SAAO,EAAK,EAC/B,OAAAD,EAAW,QAAU,GAErBE,EAAgB,IAAM,CAChB,CAACP,GAAUC,IACbI,EAAW,QAAU,GACPN,EAAA,IAAI,GAAGG,CAAa,EACpC,EACC,CAACD,CAAK,CAAC,EAEVM,EAAgB,IAAM,CAChBF,EAAW,SAGVL,IACHK,EAAW,QAAU,GACjBD,EACgBA,IAElBL,EAAc,QAAQ,EAE1B,EACC,CAAC,GAAGI,CAAW,CAAC,EAEZ,CACL,SAAU,IACHF,EAKE,KAJE,CACL,QAAS,EAAA,CAIf,CAEJ,EAEAH,EAAiB,OAAS,CAAC,CAAE,MAAAG,EAAQ,GAAM,OAAAD,MAClC,CACL,QAAS,CAACA,GAAUC,CAAA,GC/CjB,MAAMO,EAAcC,GAAmD,OAAOA,GAAU,WAElFC,EAAY,GAAQ,OAAO,OAAW,KAAe,OAAO,UAAY,OAAO,SAAS,eCArG,SAAwBC,GAA6B,CACnD,OAAID,EACK,SAAS,kBAAoB,SAE/B,EACT,CCFA,MAAME,EAAwB,CAAA,EAE9B,SAASC,EAAUC,EAAoB,CACrCF,OAAAA,EAAU,KAAKE,CAAQ,EAChB,UAAuB,CACtB,MAAAC,EAAQH,EAAU,QAAQE,CAAQ,EAC9BF,EAAA,OAAOG,EAAO,CAAC,CAAA,CAE7B,CAEA,GAAIL,EAAW,CACb,MAAMM,EAAa,IAAM,CACnB,GAACL,IACL,QAASM,EAAI,EAAGA,EAAIL,EAAU,OAAQK,GAAK,EAAG,CACtC,MAAAH,EAAWF,EAAUK,CAAC,EACnBH,GACX,CAAA,EAEK,OAAA,iBAAiB,mBAAoBE,EAAY,EAAK,CAC/D,CCtBA,SAAwBE,GAAoB,CAC1C,OAAIR,GAAa,OAAO,UAAU,OAAW,IACpC,UAAU,OAEZ,EACT,CCAA,MAAME,EAAwB,CAAA,EAE9B,SAASC,EAAUC,EAAoB,CACrC,OAAAF,EAAU,KAAKE,CAAQ,EAChB,UAAuB,CACtB,MAAAC,EAAQH,EAAU,QAAQE,CAAQ,EACpCC,EAAQ,IACAH,EAAA,OAAOG,EAAO,CAAC,CAC3B,CAEJ,CAEA,GAAIL,EAAW,CACb,MAAMM,EAAa,IAAM,CACvB,GAAI,GAACL,EAAA,GAAuB,CAACO,EAAY,GACzC,QAASD,EAAI,EAAGA,EAAIL,EAAU,OAAQK,GAAK,EAAG,CACtC,MAAAH,EAAWF,EAAUK,CAAC,EACnBH,GACX,CAAA,EAEK,OAAA,iBAAiB,mBAAoBE,EAAY,EAAK,EACtD,OAAA,iBAAiB,QAASA,EAAY,EAAK,CACpD"}